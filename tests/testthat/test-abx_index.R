weiss_sepsis <- subset(weiss2021_data, sample_id %in% "Sepsis.22441.C")
weiss_sepsis$proportion <- round(weiss_sepsis$proportion, 3)

weiss_healthy <- subset(weiss2021_data, sample_id %in% "Healthy.148")
weiss_healthy$proportion <- round(weiss_healthy$proportion, 3)

weiss_no_gram_pos <- subset(weiss2021_data, sample_id %in% "Sepsis.16001.C")
weiss_no_gram_pos$proportion <- round(weiss_no_gram_pos$proportion, 3)

test_that("vancomycin_susceptibility works on Weiss examples", {
  expect_equal(
    vancomycin_susceptibility(weiss_sepsis$lineage),
    c("resistant", "susceptible", "resistant", "resistant", "resistant"))

  expect_equal(
    vancomycin_susceptibility(weiss_healthy$lineage),
    c("resistant", "susceptible", "resistant", "resistant", "susceptible",
      "susceptible", "resistant", "susceptible", "susceptible", "susceptible",
      "susceptible", "susceptible", "susceptible", "resistant", "susceptible",
      "susceptible", "resistant", "susceptible", "resistant", "susceptible",
      "susceptible", "resistant", "susceptible", "susceptible", "susceptible",
      "resistant"))

})

test_that("vancomycin_index works on Weiss examples", {
  expect_equal(
    vancomycin_index(weiss_sepsis$proportion, weiss_sepsis$lineage),
    0.5670429, tolerance = 1e-5)

  expect_equal(
    vancomycin_index(weiss_healthy$proportion, weiss_healthy$lineage),
    0.3609116, tolerance = 1e-5)
})

test_that("tetracycline_susceptibility works on Weiss examples", {
  expect_equal(
    tetracycline_susceptibility(weiss_sepsis$lineage),
    c("susceptible", "susceptible", "resistant", "susceptible", "susceptible"))

  expect_equal(
    tetracycline_susceptibility(weiss_healthy$lineage),
    c("susceptible", "susceptible", "resistant", "susceptible", "susceptible",
      "susceptible", "susceptible", "susceptible", "susceptible", "susceptible",
      "susceptible", "susceptible", "susceptible", "susceptible", "susceptible",
      "susceptible", "susceptible", "susceptible", "susceptible", "susceptible",
      "susceptible", "susceptible", "susceptible", "susceptible", "susceptible",
      "susceptible"))

})

test_that("tetracycline_index works on Weiss examples", {
  expect_equal(
    tetracycline_index(weiss_sepsis$proportion, weiss_sepsis$lineage),
    -1.879934, tolerance = 1e-5)

  expect_equal(
    tetracycline_index(weiss_healthy$proportion, weiss_healthy$lineage),
    -1.045228, tolerance = 1e-5)
})

test_that("penicillin_susceptibility works on Weiss examples", {
  expect_equal(
    penicillin_susceptibility(weiss_sepsis$lineage),
    c("susceptible", "susceptible", "resistant", "susceptible", "susceptible"))

  expect_equal(
    penicillin_susceptibility(weiss_healthy$lineage),
    c("susceptible", "susceptible", "resistant", "susceptible", "susceptible",
      "susceptible", "susceptible", "susceptible", "susceptible", "susceptible",
      "susceptible", "susceptible", "susceptible", "susceptible", "susceptible",
      "susceptible", "susceptible", "susceptible", "susceptible", "susceptible",
      "susceptible", "susceptible", "susceptible", "susceptible", "susceptible",
      "susceptible"))
})

test_that("penicillin_index works on Weiss examples", {
  expect_equal(
    penicillin_index(weiss_sepsis$proportion, weiss_sepsis$lineage),
    -1.879934, tolerance = 1e-5)

  expect_equal(
    penicillin_index(weiss_healthy$proportion, weiss_healthy$lineage),
    -1.045228, tolerance = 1e-5)
})

test_that("aminoglycoside_susceptibility works on Weiss examples", {
  expect_equal(
    aminoglycoside_susceptibility(weiss_sepsis$lineage),
    c("resistant", "susceptible", "resistant", "resistant", "susceptible"))

  expect_equal(
    aminoglycoside_susceptibility(weiss_healthy$lineage),
    c("resistant", "resistant", "resistant", "resistant", "resistant",
      "resistant", "resistant", "resistant", "resistant", "resistant",
      "resistant", "resistant", "susceptible", "resistant", "resistant",
      "resistant", "resistant", "resistant", "resistant", "resistant",
      NA, NA, "resistant", "resistant", "resistant", "resistant"))
})

test_that("aminoglycoside_index works on Weiss examples", {
  expect_equal(
    aminoglycoside_index(weiss_sepsis$proportion, weiss_sepsis$lineage),
    0.5644559, tolerance = 1e-5)

  expect_equal(
    aminoglycoside_index(weiss_healthy$proportion, weiss_healthy$lineage),
    2.21396, tolerance = 1e-5)
})

test_that("gram_positive_index works on Weiss examples", {
  expect_equal(
    gram_positive_index(weiss_sepsis$proportion, weiss_sepsis$lineage),
    0.5644559, tolerance = 1e-5)

  expect_equal(
    gram_positive_index(weiss_healthy$proportion, weiss_healthy$lineage),
    0.9650513, tolerance = 1e-5)
})

test_that("gram_positive_index and gram_negative_index are inverses", {
  expect_equal(
    gram_positive_index(weiss_sepsis$proportion, weiss_sepsis$lineage),
    -gram_negative_index(weiss_sepsis$proportion, weiss_sepsis$lineage))

  expect_equal(
    gram_positive_index(weiss_healthy$proportion, weiss_healthy$lineage),
    -gram_negative_index(weiss_healthy$proportion, weiss_healthy$lineage))
})

test_that("anaerobes_index works on Weiss examples", {
  expect_equal(
    anaerobes_index(weiss_sepsis$proportion, weiss_sepsis$lineage),
    1.788434, tolerance = 1e-5)

  expect_equal(
    anaerobes_index(weiss_healthy$proportion, weiss_healthy$lineage),
    -2.21396, tolerance = 1e-5)
})

test_that("anaerobes_index and aerobes_index are inverses", {
  expect_equal(
    anaerobes_index(weiss_sepsis$proportion, weiss_sepsis$lineage),
    -aerobes_index(weiss_sepsis$proportion, weiss_sepsis$lineage))

  expect_equal(
    anaerobes_index(weiss_healthy$proportion, weiss_healthy$lineage),
    -aerobes_index(weiss_healthy$proportion, weiss_healthy$lineage))
})

test_that("antibioitc_index does not produce infinite values", {
  expect_equal(
    gram_positive_index(weiss_no_gram_pos$proportion, weiss_no_gram_pos$lineage),
    3.999565, tolerance = 1e-5)
})
